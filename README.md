# MyTechBlog - 现代化的 .NET 10 个人技术博客系统

欢迎来到 **球球布丁的后花园 (Fan's Tech Blog)**！这是一个基于 **ASP.NET Core (.NET 10)** 构建的全栈 Web 应用示例。它不仅是一个功能完备的个人博客，更是一个展示现代 Web 开发最佳实践的教学项目。

本项目展示了如何将 **MVC 架构**、**云存储 (Cloudflare R2)**、**智能资源管理**以及**极致的前端体验**完美融合。

## 📅 更新日志 (Update Log)

### 2025-12-03 (深夜): Phase 2 完美收官 - 混合架构就绪
*   **API 覆盖率达到 90%**: 完成了核心的 **只读 API** (文章列表、详情、评论浏览) 和 **认证 API**。
*   **架构状态**: 项目正式进入 "Hybrid State"（混合态）。
    *   **MVC 端**: 继续负责完整的后台管理（写文章、传图片）。
    *   **API 端**: 已准备好为即将启动的 Next.js 前端提供数据服务。
*   **下一步**: 启动 Phase 3，初始化 Next.js 项目，优先构建只读版的前端体验。

### 2025-12-03: 前端布局优化与修复
*   **UI 结构性修复**:
    *   **移动端导航菜单 (Offcanvas)**: 修复了移动端侧滑菜单的嵌套错误，将其从导航栏中移出，确保全屏高度显示。同时优化了其样式（背景、圆角、阴影），解决了内容溢出和视觉不协调的问题。
    *   **文章编辑/创建页**: 修复了 `Create.cshtml` 和 `Edit.cshtml` 中 `div` 标签的闭合错误，确保页面结构正确。
    *   **底部操作栏与页脚**: 在文章编辑/创建页面，现在会隐藏网站页脚，以避免与底部固定操作栏（保存/发布按钮）重叠，提供更干净的写作界面。
*   **前端布局与响应式优化**:
    *   **页面宽度统一**: 移除了首页 (`Home/Index`) 和关于页 (`Home/About`) 中冗余的宽度限制 (`col-lg-8`)，确保页面内容能更合理地利用全局 800px 的最大宽度。
    *   **文章列表页头部**: 为文章列表页的标题和操作按钮添加了 `flex-wrap`，防止在小屏幕设备上内容挤压和溢出。
    *   **文章摘要显示**: 引入 CSS `line-clamp` 技术，使文章列表页的摘要统一截断为 3 行，提升移动端列表的整齐度和美观性。
    *   **桌面端导航回归**: 修复了因结构调整导致桌面端导航菜单消失的问题，通过 CSS 巧妙解决了移动端侧边栏高度截断的难题，实现了“一套代码，双端完美”。
    *   **搜索框视觉统一**: 重构了导航栏搜索框样式，消除了输入框与按钮之间的割裂感，实现了统一的胶囊外观和聚焦高亮效果。
*   **功能增强**:
    *   **即时分类创建**: 在文章编辑器中新增了“快速添加分类”功能。采用现代化的前后端分离架构：
        *   **后端**: 新增 `CategoryService` 与 `CategoriesController` (API)，遵循 Service-Repository 模式。
        *   **前端**: 集成 **SweetAlert2** 实现优雅的弹窗交互，利用 Fetch API 实现无刷新数据提交与下拉框动态更新。
    *   **评论系统升级**: 重构了评论功能，从传统的表单提交升级为 **AJAX 无刷新提交**，并实现了**分页加载 (Load More)** 机制，显著提升了用户体验和服务器性能。
    *   **登录持久化**: 修复了登录状态无法保存的问题，新增了 **"记住我"** 功能（Cookie 持久化），提升了管理员的使用便利性。

### 2025-12-03 (晚间): 架构升级 - 迈向前后端分离 (Phase 2 Kick-off)
为了实现 **"Hybrid to Headless"** 的演进目标，我们完成了后端基础设施的关键改造：
*   **双重认证体系 (Dual Auth)**: 
    *   **Cookie**: 继续服务于现有的 MVC 页面（浏览器端）。
    *   **JWT (JSON Web Token)**: 新增了 JWT 认证支持，并实现了 `POST /api/auth/login` 接口。这为未来独立的 **Next.js 前端** 或 **移动端 App** 提供了标准的身份验证入口。
*   **API 文档化 (Swagger)**: 引入并配置了 **Swagger UI**。现在访问 `/swagger` 即可查看自动生成的 API 文档，极大地方便了接口调试和前端开发。
*   **API 标准化**: 确立了 "Service + Controller (API) + DTO" 的开发规范，逐步将业务逻辑从 MVC 控制器剥离。
*   **内容 API (Posts API)**: 完成了最后一块拼图 —— `PostsApiController`。
    *   实现了 `GET /api/posts` (列表) 和 `GET /api/posts/{id}` (详情) 接口。
    *   支持分页、搜索、分类过滤。
    *   **智能 DTO**: 列表接口自动提取 Markdown 纯文本摘要和首图作为封面，实现轻量化传输。
    *   **Headless Ready**: 至此，后端已具备完全独立服务于第三方前端（React/Vue/App）的能力。

### 2025-12-01: 品牌重塑与功能增强
*   **品牌升级**: 将博客名称从 "MyTechBlog" 正式更名为 **"球球布丁的后花园"**，融入了猫咪元素（球球&布丁），打造温馨的技术生活空间。
*   **UI 重构**:
    *   **导航栏**: 重新设计了导航结构，增加了 **"猫咪相册"**、**"碎碎念"**、**"归档"** 和 **"关于铲屎官"** 的入口。
    *   **搜索功能**: 实现了全局搜索功能。后端支持按标题和内容过滤文章，前端实现了带有回显功能的搜索框。
    *   **关于页面**: 新增了独立的人物介绍页面 (`/Home/About`)，展示博主与猫咪的详细信息。
    *   **视觉微调**: 加宽了首页欢迎语区域 (`col-lg-8`)，修复了搜索框输入框与按钮的边框样式问题。
*   **功能实现**:
    *   后端 `PostService` 增加了 `searchTerm` 支持。
    *   控制器 `PostsController` 更新了 `Index` 方法以处理搜索请求。

---

## ✨ 核心亮点 (Features)

### 1. 极致的写作体验 ✍️
这里是为了让你写博客像写代码一样流畅：
*   **Markdown 支持**: 你不需要像在 Word 里那样点按钮调整格式。只需要输入 `# 标题` 或 `**加粗**`，内置的 **Markdig** 引擎就会自动把它变成漂亮的网页排版。
*   **Mermaid 图表**: 想画流程图？不用打开 Visio。直接在文章里写几行代码，就能自动生成流程图、时序图甚至甘特图。
*   **全方位图片上传**:
    *   **粘贴上传**: 截图后直接 `Ctrl+V`，系统会自动把图片上传，并把链接填到文章里。
    *   **拖拽上传**: 把一堆图片（甚至整个文件夹里的图片）直接拖进编辑器，系统会自动排队上传。
    *   **点击上传**: 当然，传统的“点击按钮选择文件”也保留着。
*   **前端性能优化**: 为了让你的博客加载飞快，我们在浏览器端引入了 `compressorjs`。在你上传图片的那一瞬间，它会自动把图片压缩成 **WebP 格式**（一种比 JPG/PNG 更小更清晰的现代格式）。这意味着：**上传更快，访客打开文章也更快！**
*   **交互反馈系统**:
    *   **实时状态提示 (Toasts)**: 无论你在做什么操作（压缩中、上传中、成功），页面右上角都会弹出一个小卡片（Toast）告诉你当前进度，不用对着屏幕干着急。
    *   **批量上传与汇总**: 支持一次性拖拽多张图片。系统会自动建立上传队列，全部处理完成后会给你一份“体检报告”：“上传完成：成功 10 张，失败 0 张”。
    *   **安全熔断机制**: 为了防止你误操作拖入几百张图导致浏览器卡死，系统限制单次最多上传 **50 张**。
    *   **智能错误处理**: 如果某张图传失败了，编辑器里会直接显示“加载失败”，让你一眼就能看到并重试。

### 2. 智能资源管理 (Smart Asset Management) 🧠
我们没有把图片简单的存在网站文件夹里，而是用了更高级的方案：
*   **云端存储 (Cloudflare R2)**: 所有的图片都存放在云端对象存储中（类似网盘）。
    *   **为什么？** 这样你的网站服务器可以很轻量，哪怕只有 1 核 1G 的配置，也能存下海量的图片，而且备份和迁移非常方便。
*   **引用追踪**: 数据库里有一张表专门记录“哪张图属于哪篇文章”。
*   **自动垃圾回收**:
    *   当你删除一篇文章时，系统会自动去云端把这篇文章对应的图片统统删掉，**不留垃圾文件**。
    *   **僵尸清理**: 如果你写文章时传了图，最后没点发布就关了页面，这些图就成了“僵尸文件”。管理员可以一键清理它们，节省云存储费用。

### 3. 极简用户系统 🛡️
*   **自动赋权**:
    *   系统的逻辑很简单：**第一个注册的人就是老大（管理员）**。
    *   之后注册的所有人都是普通访客。你不需要懂数据库就能拥有管理员权限。
*   **安全认证**: 用户的密码绝不会以明文存储。我们使用 **BCrypt** 算法把密码打乱成一串乱码存进数据库，即使数据库泄露，黑客也猜不出密码。
*   **文章隐藏与草稿**: 没写完的文章可以勾选“隐藏”。这样只有管理员能在列表里看到（带个灰色标记），普通访客是看不到的。
*   **作者归属**: 每一篇文章都会自动盖上作者的“戳”（显示发布者名字），适合将来扩展成多人博客。

### 4. 优秀的阅读体验 📖
*   **分类筛选**: 点击文章标题下的“分类标签”，就能只看这个分类的文章。
*   **表格优化**: 专门为技术文档优化的表格样式（带边框、隔行变色），看数据报表不眼花。
*   **懒加载 (Lazy Loading)**: 文章里的图片只有当你滚动到它位置时才会加载，既省流量又加快首屏速度。
*   **Lightbox (灯箱效果)**: 觉得图片太小看不清？点一下，它会平滑放大到全屏。
*   **摘要统一截断**: 文章列表页的摘要现在会智能截断为 3 行，保持排版整洁。

---

## 🛠 技术栈架构 (Tech Stack)

本项目采用了经典的分层架构，就像经营一家餐厅，每个人各司其职：

| 角色 | 对应代码层 | 职责说明 |
| :--- | :--- | :--- |
| **服务员** | `Controllers/` | **控制器层**。比如 `PostsController`。它负责接待用户（浏览器）的请求，比如“我要看文章列表”，然后指挥后厨去做，最后把做好的页面端给用户。 |
| **大厨** | `Services/` | **业务逻辑层**。比如 `PostService`。它是真正干活的。控制器告诉它“我要所有文章”，它就去数据库里查，然后整理好数据返回。它还负责处理复杂的逻辑，比如“删文章时顺便把图片也删了”。 |
| **仓库** | `Models/` | **数据模型**。比如 `Post` (文章), `User` (用户)。它们定义了数据长什么样（有哪些字段，比如标题、内容、时间）。 |
| **菜单** | `Views/` | **视图层**。就是用户看到的网页（HTML）。它是一个模板，填入数据后就变成了丰富多彩的页面。 |
| **装修** | `wwwroot/` | **静态资源**。这里的 CSS (样式) 和 JS (脚本) 负责让网页变得好看、好用。 |

*   **框架**: .NET 10 (ASP.NET Core MVC) —— 微软最新、最快的 Web 开发框架。
*   **数据库**: SQLite —— 一个轻量级的文件数据库，不需要复杂的安装配置，一个文件就是整个数据库，非常适合个人项目。
*   **前端**: Bootstrap 5 —— 全球最流行的 UI 框架，帮你快速画出好看的按钮、导航栏和排版。

---

## 🚀 快速开始

### 环境准备
确保已安装 **.NET 10 SDK**。

### 1. 配置云存储 (Cloudflare R2)
打开 `appsettings.json`，配置你的 R2 存储桶信息：
```json
"CloudflareR2": {
    "ServiceUrl": "https://<ACCOUNT_ID>.r2.cloudflarestorage.com",
    "AccessKey": "<YOUR_ACCESS_KEY>",
    "SecretKey": "<YOUR_SECRET_KEY>",
    "BucketName": "<YOUR_BUCKET_NAME>",
    "PublicDomain": "https://<YOUR_CUSTOM_DOMAIN>"
}
```

### 2. 初始化数据库
运行以下命令生成 SQLite 数据库文件 (`blog.db`)：
```bash
dotnet ef database update
```

### 3. 启动项目
```bash
dotnet run
```
访问 `http://localhost:5000`，注册第一个账号，开始你的博客之旅！

---

## 🔍 深度功能解析

### 图片上传全流程
1.  **前端捕获**: 监听 `paste` / `drop` / `change` 事件。
2.  **前端压缩**: `Compressor.js` 将图片转为 Quality 0.8 的 WebP。
3.  **即时反馈**: 编辑器插入 `![图片上传中...](ID)` 占位符。
4.  **后端处理**: 
    *   `UploadController` 接收流。
    *   `R2StorageService` 上传至 R2。
    *   `ImageService` 在数据库创建一条 `PostId=null` 的孤儿记录。
5.  **回填**: 前端收到 URL，替换占位符。

### 垃圾回收机制
当你在写文章时上传了图片，但最后取消了发布，这张图片就变成了“僵尸”。
*   **手动清理**: 管理员可调用 API 接口 `POST /api/upload/cleanup`。
*   **逻辑**: 系统查找所有 `PostId` 为空且上传超过 24 小时的记录，从 R2 删除文件并清除数据库。

---

## 🤝 贡献与学习建议
本项目非常适合作为 .NET 入门实战教材。你可以尝试以下挑战：
1.  **搜索功能**: 给博客添加一个搜索框，支持标题和内容搜索。（已完成 ✅）
2.  **RSS 订阅**: 生成 `rss.xml` 供阅读器订阅。
3.  **暗黑模式**: 利用 Bootstrap 5 的 Dark Mode 支持实现主题切换。

## 🗺️ 未来规划 (Roadmap)

我们计划将博客打造成一个结合**硬核技术**与**温馨生活**的混合空间。目前的待办事项包括：

### 1. 猫咪相册 (Gallery) 🐱
*   **目标**: 创建一个专门展示球球和布丁日常照片的页面。
*   **实现思路**: 复用 `Post` 模型，约定一个特定的 Category (如 `CatLife`)。前端使用 **Masonry (瀑布流)** 布局来展示图片卡片，弱化文字，强调视觉体验。

### 2. 碎碎念 (Microblog) 💬
*   **目标**: 记录简短的生活感悟或技术灵感，类似 Twitter/微博。
*   **实现思路**: 同样复用 `Post` 模型 (Category: `Thoughts`)。前端采用 **时间轴 (Timeline)** 样式，按时间倒序排列，无需标题，直接展示内容。

### 3. 归档与标签 (Archives & Tags) 🏷️
*   **归档**: 实现按 `年份-月份` 折叠的文章列表。
*   **标签**: 引入多对多 (Many-to-Many) 的标签系统，补充现有的单一分类系统，方便按技术栈（如 `.NET`, `Azure`, `React`）检索文章。

---

## 🎨 设计哲学与技术演进 (Design & Architecture Manifesto)

本项目不仅仅是一个代码仓库，它遵循一套严谨的设计语言与技术演进路线，旨在从传统的 MVC 应用平滑过渡到现代化的前后端分离架构。

### 1. 设计基调：Cozy Modernism (温馨现代主义)
*技术是硬核的，但体验是柔软的。*

*   **视觉语言**:
    *   **胶囊与圆角**: 拒绝尖锐直角，所有交互元素（按钮、输入框、标签）均采用 `rounded-pill` 或大圆角，隐喻猫咪肉垫般的友好触感。
    *   **功能性毛玻璃**: 仅在层级叠加处（导航栏、侧滑菜单、底部工具栏）使用高斯模糊 (`backdrop-filter`)，营造轻盈的悬浮感与空间感。
    *   **温暖科技色**: 以 `#e67e22` (焦糖色) 为主色调，配合 `#f8f9fa` (Off-white) 柔和背景，打造纸质阅读体验。
*   **交互原则**:
    *   **无刷新优先 (No-Refresh First)**: 也就是 AJAX/Fetch 优先。能弹窗解决的不跳转，能局部更新的不刷新。
    *   **即时反馈**: 任何操作（上传、保存、创建）都必须伴随 Toast 提示或视觉状态变更。

### 2. 技术架构路线：Hybrid to Headless (从混合到分离)
我们采用 **"绞杀植物模式" (Strangler Fig Pattern)**，在现有 MVC 架构上逐步生长出 API 架构。

*   **阶段 1: 现代化 MVC (Current Phase)**
    *   **API First**: 新增的写操作（如 `Create Category`）必须开发独立的 API 接口，MVC Controller 仅作为视图外壳。
    *   **Service 核心化**: 严禁在 Controller 中直接操作数据库，所有逻辑下沉至 Service 层 (`CategoryService`, `PostService`)。
    *   **瘦客户端增强**: 逐步剥离 jQuery，引入现代 JS 逻辑处理复杂交互。
*   **阶段 2: 混合架构 (已完成 ✅)**
    *   **API 文档化**: 集成 Swagger，实现接口可视化调试。
    *   **双重认证 (Dual Auth)**: 实现 Cookie + JWT 并存，打通了独立客户端的访问通道。
    *   **Headless Ready**: 完成了核心的只读 API (Posts, Comments, Auth)，后端已准备好被“无头”调用。

*   **阶段 3: 彻底分离 (Headless Evolution - 进行中 🚧)**
    *   **Stage 3.1: 只读前端 (MVP)**
        *   初始化 **Next.js** 项目。
        *   基于 React 重写首页、文章列表与详情页，实现极致的加载速度 (SSG/ISR)。
    *   **Stage 3.2: 写操作 API 补全**
        *   补全 `Create/Update Post` API。
        *   改造 `UploadController` 以支持 JWT 验证。
    *   **Stage 3.3: 管理后台迁移**
        *   在 Next.js 中实现基于 JWT 的登录与权限管理。
        *   移植 Markdown 编辑器，彻底告别 MVC 视图层，实现 100% 前后端分离。

Enjoy coding! 🚀
