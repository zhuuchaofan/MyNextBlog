{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/fanxiang/MyTechBlog/frontend/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Input({ className, type, ...props }: React.ComponentProps<\"input\">) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        \"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        \"focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]\",\n        \"aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC;IACzE,qBACE,8OAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,8bACA,iFACA,0GACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/fanxiang/MyTechBlog/frontend/components/ui/label.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        \"flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,MAAM,EACb,SAAS,EACT,GAAG,OAC8C;IACjD,qBACE,8OAAC,yKAAmB;QAClB,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,uNACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 56, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/fanxiang/MyTechBlog/frontend/components/ui/textarea.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Textarea({ className, ...props }: React.ComponentProps<\"textarea\">) {\n  return (\n    <textarea\n      data-slot=\"textarea\"\n      className={cn(\n        \"border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Textarea }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,SAAS,EAAE,SAAS,EAAE,GAAG,OAAyC;IACzE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,ucACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/fanxiang/MyTechBlog/frontend/components/MarkdownEditor.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Textarea } from \"@/components/ui/textarea\";\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport rehypeHighlight from 'rehype-highlight';\nimport { Button } from \"@/components/ui/button\";\nimport { Bold, Italic, List, Image as ImageIcon, Eye, Code, Quote, Link as LinkIcon } from 'lucide-react';\nimport 'highlight.js/styles/github-dark.css'; \nimport { useAuth } from '@/context/AuthContext';\n\ninterface MarkdownEditorProps {\n  value: string;\n  onChange: (value: string) => void;\n}\n\nexport default function MarkdownEditor({ value, onChange }: MarkdownEditorProps) {\n  const [preview, setPreview] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const { token } = useAuth();\n\n  // 插入文本辅助函数\n  const insertText = (before: string, after: string = '') => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n\n    const start = textarea.selectionStart;\n    const end = textarea.selectionEnd;\n    const text = textarea.value;\n    const selection = text.substring(start, end);\n\n    const newText = text.substring(0, start) + before + selection + after + text.substring(end);\n    onChange(newText);\n\n    // 恢复光标位置并聚焦\n    setTimeout(() => {\n      textarea.focus();\n      textarea.setSelectionRange(start + before.length, end + before.length);\n    }, 0);\n  };\n\n  // 处理图片上传\n  const handleUpload = async (file: File) => {\n    if (!file || !token) return;\n\n    // 1. 插入占位符\n    const placeholder = `![上传中... (${file.name})]()`;\n    insertText(placeholder);\n\n    try {\n      // 2. 构建 FormData\n      const formData = new FormData();\n      formData.append('file', file);\n\n      // 3. 上传\n      const res = await fetch('/api/backend/upload', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}` // JWT 认证\n        },\n        body: formData\n      });\n\n      if (!res.ok) throw new Error('上传失败');\n\n      const data = await res.json();\n      \n      // 4. 替换占位符为真实 Markdown 链接\n      const markdownImage = `![image](${data.url})`;\n      const newContent = textareaRef.current?.value.replace(placeholder, markdownImage) || '';\n      onChange(newContent);\n\n    } catch (error) {\n      alert('图片上传失败');\n      // 移除占位符\n      const newContent = textareaRef.current?.value.replace(placeholder, '') || '';\n      onChange(newContent);\n    }\n  };\n\n  // 监听粘贴事件\n  const handlePaste = (e: React.ClipboardEvent) => {\n    const files = e.clipboardData.files;\n    if (files && files.length > 0) {\n      const file = files[0];\n      if (file.type.startsWith('image/')) {\n        e.preventDefault(); // 阻止默认粘贴行为\n        handleUpload(file);\n      }\n    }\n  };\n\n  // 监听拖拽事件\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    const files = e.dataTransfer.files;\n    if (files && files.length > 0) {\n      const file = files[0];\n      if (file.type.startsWith('image/')) {\n        handleUpload(file);\n      }\n    }\n  };\n\n  return (\n    <div className=\"border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm\">\n      {/* 工具栏 */}\n      <div className=\"flex items-center justify-between p-2 border-b border-gray-100 bg-gray-50/50\">\n        <div className=\"flex items-center gap-1\">\n          <ToolbarButton icon={<Bold className=\"w-4 h-4\" />} onClick={() => insertText('**', '**')} title=\"加粗\" />\n          <ToolbarButton icon={<Italic className=\"w-4 h-4\" />} onClick={() => insertText('*', '*')} title=\"斜体\" />\n          <ToolbarButton icon={<Quote className=\"w-4 h-4\" />} onClick={() => insertText('> ')} title=\"引用\" />\n          <ToolbarButton icon={<Code className=\"w-4 h-4\" />} onClick={() => insertText('```\\n', '\\n```')} title=\"代码块\" />\n          <div className=\"w-px h-4 bg-gray-300 mx-2\"></div>\n          <ToolbarButton icon={<LinkIcon className=\"w-4 h-4\" />} onClick={() => insertText('[', '](url)')} title=\"链接\" />\n          <ToolbarButton icon={<List className=\"w-4 h-4\" />} onClick={() => insertText('- ')} title=\"列表\" />\n          <ToolbarButton icon={<ImageIcon className=\"w-4 h-4\" />} onClick={() => document.getElementById('image-upload')?.click()} title=\"上传图片\" />\n          <input \n            type=\"file\" \n            id=\"image-upload\" \n            className=\"hidden\" \n            accept=\"image/*\"\n            onChange={(e) => e.target.files?.[0] && handleUpload(e.target.files[0])} \n          />\n        </div>\n        \n        <Button \n          variant={preview ? \"secondary\" : \"ghost\"} \n          size=\"sm\"\n          onClick={() => setPreview(!preview)}\n          className=\"text-xs gap-2\"\n        >\n          <Eye className=\"w-4 h-4\" />\n          {preview ? '编辑模式' : '预览模式'}\n        </Button>\n      </div>\n\n      {/* 编辑区 / 预览区 */}\n      <div className=\"relative min-h-[500px]\">\n        {preview ? (\n          <div className=\"prose prose-stone max-w-none p-6 h-[500px] overflow-y-auto\">\n            <ReactMarkdown \n              remarkPlugins={[remarkGfm]} \n              rehypePlugins={[rehypeHighlight]}\n              components={{\n                 img: ({node, ...props}) => (\n                   // eslint-disable-next-line @next/next/no-img-element\n                   <img {...props} className=\"rounded-lg shadow-sm max-h-[400px] mx-auto\" alt={props.alt || ''} />\n                 )\n              }}\n            >\n              {value || '*暂无内容*'}\n            </ReactMarkdown>\n          </div>\n        ) : (\n          <Textarea \n            ref={textareaRef}\n            value={value}\n            onChange={(e) => onChange(e.target.value)}\n            onPaste={handlePaste}\n            onDrop={handleDrop}\n            onDragOver={(e) => e.preventDefault()}\n            className=\"w-full h-[500px] p-6 border-0 focus-visible:ring-0 rounded-none resize-none font-mono text-sm leading-relaxed\"\n            placeholder=\"开始创作... (支持 Markdown, 粘贴图片)\"\n          />\n        )}\n      </div>\n      \n      <div className=\"bg-gray-50 px-4 py-2 text-xs text-gray-400 border-t border-gray-100 flex justify-between\">\n         <span>Markdown Supported</span>\n         <span>{value.length} chars</span>\n      </div>\n    </div>\n  );\n}\n\nfunction ToolbarButton({ icon, onClick, title }: { icon: React.ReactNode, onClick: () => void, title: string }) {\n  return (\n    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 hover:bg-gray-200 text-gray-600\" onClick={onClick} title={title} type=\"button\">\n      {icon}\n    </Button>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 515, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/fanxiang/MyTechBlog/frontend/lib/api.ts"],"sourcesContent":["export interface Comment {\n  id: number;\n  guestName: string;\n  content: string;\n  createTime: string;\n}\n\nexport async function fetchComments(postId: number, page = 1) {\n  const res = await fetch(`/api/backend/comments?postId=${postId}&page=${page}&pageSize=100`); // 简单起见，先取 100 条\n  return res.json();\n}\n\nexport async function submitComment(postId: number, content: string, guestName: string) {\n  const res = await fetch('/api/backend/comments', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ postId, content, guestName })\n  });\n  return res.json();\n}\n\nexport interface Category {\n  id: number;\n  name: string;\n}\n\nexport async function fetchCategories() {\n  // 由于我们没有专门的 GET /api/categories，暂时先用 Posts API 的附属数据或者假设有一个接口\n  // 这里我们需要后端补充一个 GET /api/categories 接口\n  const res = await fetch('/api/backend/categories'); \n  return res.json();\n}\n\nexport async function createPost(token: string, postData: { title: string; content: string; categoryId?: number }) {\n  const res = await fetch('/api/backend/posts', {\n    method: 'POST',\n    headers: { \n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${token}`\n    },\n    body: JSON.stringify(postData)\n  });\n\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`API Error: ${res.status} ${res.statusText} - ${text}`);\n  }\n\n  return res.json();\n}\n\nexport async function updatePost(token: string, id: number, postData: { title: string; content: string; categoryId?: number }) {\n  const res = await fetch(`/api/backend/posts/${id}`, {\n    method: 'PUT',\n    headers: { \n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${token}`\n    },\n    body: JSON.stringify(postData)\n  });\n\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`API Error: ${res.status} ${res.statusText} - ${text}`);\n  }\n\n  return res.json();\n}\n\nexport async function deletePost(token: string, id: number) {\n  const res = await fetch(`/api/backend/posts/${id}`, {\n    method: 'DELETE',\n    headers: { \n      'Authorization': `Bearer ${token}`\n    }\n  });\n\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`API Error: ${res.status} ${res.statusText} - ${text}`);\n  }\n\n  return res.json();\n}\n\nexport async function fetchPostsWithAuth(token: string, page = 1) {\n  const res = await fetch(`/api/backend/posts?page=${page}&pageSize=100`, {\n    headers: { \n      'Authorization': `Bearer ${token}` // 带 Token 才能看到隐藏文章\n    }\n  });\n  return res.json();\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAOO,eAAe,cAAc,MAAc,EAAE,OAAO,CAAC;IAC1D,MAAM,MAAM,MAAM,MAAM,CAAC,6BAA6B,EAAE,OAAO,MAAM,EAAE,KAAK,aAAa,CAAC,GAAG,gBAAgB;IAC7G,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,cAAc,MAAc,EAAE,OAAe,EAAE,SAAiB;IACpF,MAAM,MAAM,MAAM,MAAM,yBAAyB;QAC/C,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YAAE;YAAQ;YAAS;QAAU;IACpD;IACA,OAAO,IAAI,IAAI;AACjB;AAOO,eAAe;IACpB,8DAA8D;IAC9D,sCAAsC;IACtC,MAAM,MAAM,MAAM,MAAM;IACxB,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,WAAW,KAAa,EAAE,QAAiE;IAC/G,MAAM,MAAM,MAAM,MAAM,sBAAsB;QAC5C,QAAQ;QACR,SAAS;YACP,gBAAgB;YAChB,iBAAiB,CAAC,OAAO,EAAE,OAAO;QACpC;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,IAAI,MAAM,CAAC,CAAC,EAAE,IAAI,UAAU,CAAC,GAAG,EAAE,MAAM;IACxE;IAEA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,WAAW,KAAa,EAAE,EAAU,EAAE,QAAiE;IAC3H,MAAM,MAAM,MAAM,MAAM,CAAC,mBAAmB,EAAE,IAAI,EAAE;QAClD,QAAQ;QACR,SAAS;YACP,gBAAgB;YAChB,iBAAiB,CAAC,OAAO,EAAE,OAAO;QACpC;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,IAAI,MAAM,CAAC,CAAC,EAAE,IAAI,UAAU,CAAC,GAAG,EAAE,MAAM;IACxE;IAEA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,WAAW,KAAa,EAAE,EAAU;IACxD,MAAM,MAAM,MAAM,MAAM,CAAC,mBAAmB,EAAE,IAAI,EAAE;QAClD,QAAQ;QACR,SAAS;YACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;QACpC;IACF;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,IAAI,MAAM,CAAC,CAAC,EAAE,IAAI,UAAU,CAAC,GAAG,EAAE,MAAM;IACxE;IAEA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,mBAAmB,KAAa,EAAE,OAAO,CAAC;IAC9D,MAAM,MAAM,MAAM,MAAM,CAAC,wBAAwB,EAAE,KAAK,aAAa,CAAC,EAAE;QACtE,SAAS;YACP,iBAAiB,CAAC,OAAO,EAAE,OAAO,CAAC,mBAAmB;QACxD;IACF;IACA,OAAO,IAAI,IAAI;AACjB"}},
    {"offset": {"line": 610, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/fanxiang/MyTechBlog/frontend/app/admin/posts/%5Bid%5D/edit/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, use } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/context/AuthContext';\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport MarkdownEditor from '@/components/MarkdownEditor';\nimport { fetchCategories, updatePost, Category } from '@/lib/api';\nimport { ChevronLeft, Save } from 'lucide-react';\nimport { toast } from \"sonner\";\n\nexport default function EditPostPage({ params }: { params: Promise<{ id: string }> }) {\n  // 解包 params Promise (Next.js 15)\n  const { id } = use(params); \n  const { token, user } = useAuth();\n  const router = useRouter();\n  \n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  const [categoryId, setCategoryId] = useState<number | undefined>(undefined);\n  const [categories, setCategories] = useState<Category[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [fetching, setFetching] = useState(true);\n\n  // 鉴权、加载分类、回显文章\n  useEffect(() => {\n    if (!token || user?.role !== 'Admin') {\n      // router.push('/login'); // 这里为了防闪烁先注释，或者放在外层 layout 做\n      return;\n    }\n\n    const init = async () => {\n      try {\n        // 1. 加载分类\n        const catRes = await fetchCategories();\n        if (catRes.success) setCategories(catRes.data);\n\n        // 2. 加载文章详情\n        // 复用 Public API (注意：这里请求的是 Next.js 代理后的地址，不是 .NET 端口)\n        const postRes = await fetch(`/api/backend/posts/${id}`);\n        const postData = await postRes.json();\n        \n        if (postData.success) {\n          const p = postData.data;\n          setTitle(p.title);\n          setContent(p.content);\n          setCategoryId(p.categoryId === 0 ? undefined : p.categoryId);\n        } else {\n          toast.error('文章不存在');\n          router.push('/admin/posts');\n        }\n      } catch (err) {\n        toast.error('加载失败');\n      } finally {\n        setFetching(false);\n      }\n    };\n\n    init();\n  }, [token, user, router, id]);\n\n  const handleSubmit = async () => {\n    if (!title.trim()) {\n      toast.warning('请输入文章标题');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const res = await updatePost(token!, parseInt(id), { \n        title, \n        content, \n        categoryId \n      });\n      \n      if (res.success) {\n        toast.success('更新成功！');\n        router.push('/admin/posts'); \n      } else {\n        toast.error('更新失败: ' + res.message);\n      }\n    } catch (error: any) {\n      toast.error('网络错误');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (fetching) return <div className=\"p-10 text-center\">加载文章数据中...</div>;\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-5xl\">\n      {/* 顶部操作栏 */}\n      <div className=\"flex items-center justify-between mb-6\">\n         <div className=\"flex items-center gap-4\">\n           <Button variant=\"ghost\" onClick={() => router.back()} className=\"text-gray-500\">\n             <ChevronLeft className=\"w-4 h-4 mr-1\" /> 返回列表\n           </Button>\n           <h1 className=\"text-2xl font-bold text-gray-900\">编辑文章</h1>\n         </div>\n         <Button onClick={handleSubmit} disabled={loading} className=\"bg-orange-500 hover:bg-orange-600\">\n           {loading ? '保存中...' : <><Save className=\"w-4 h-4 mr-2\" /> 保存修改</>}\n         </Button>\n      </div>\n\n      <div className=\"grid gap-6\">\n        {/* 标题输入 */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"title\" className=\"text-lg font-semibold\">文章标题</Label>\n          <Input \n            id=\"title\" \n            className=\"text-2xl py-6 font-bold border-transparent bg-white shadow-sm hover:border-orange-200 focus:border-orange-500 transition-all\"\n            value={title}\n            onChange={e => setTitle(e.target.value)}\n          />\n        </div>\n\n        {/* 分类选择 */}\n        <div className=\"space-y-2\">\n           <Label className=\"font-semibold\">选择分类</Label>\n           <div className=\"flex gap-2 flex-wrap\">\n             {categories.map(cat => (\n               <Button \n                 key={cat.id} \n                 type=\"button\"\n                 variant={categoryId === cat.id ? 'default' : 'outline'}\n                 onClick={() => setCategoryId(cat.id)}\n                 className={`rounded-full ${categoryId === cat.id ? 'bg-orange-500 hover:bg-orange-600' : ''}`}\n               >\n                 {cat.name}\n               </Button>\n             ))}\n           </div>\n        </div>\n\n        {/* Markdown 编辑器 */}\n        <div className=\"space-y-2\">\n           <Label className=\"font-semibold\">正文内容</Label>\n           <MarkdownEditor value={content} onChange={setContent} />\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}