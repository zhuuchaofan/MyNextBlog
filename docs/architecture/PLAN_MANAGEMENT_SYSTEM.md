# ğŸ“… è®¡åˆ’ç®¡ç†ç³»ç»Ÿ (Plan Management System)

> ç”¨äºç®¡ç†æ—…è¡Œè®¡åˆ’ã€æ´»åŠ¨å®‰æ’å’ŒæƒŠå–œè¡Œç¨‹çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚

## 1. æ¦‚è¿°

è®¡åˆ’ç®¡ç†ç³»ç»Ÿæ˜¯ MyNextBlog çš„æ‰©å±•æ¨¡å—ï¼Œä¸“ä¸ºç®¡ç†å¤šæ—¥è¡Œç¨‹ã€é¢„ç®—è¿½è¸ªå’Œç§˜å¯†æƒŠå–œè®¾è®¡ã€‚å®ƒä¸çºªå¿µæ—¥ç³»ç»Ÿæ·±åº¦é›†æˆï¼Œæ”¯æŒå…³è”çºªå¿µæ—¥ã€æå‰é‚®ä»¶æé†’å’ŒæƒŠå–œæ­æ™“åŠ¨ç”»ã€‚

## 2. æ ¸å¿ƒå®ä½“

### 2.1 æ•°æ®æ¨¡å‹

```text
Plan (è®¡åˆ’)
â”œâ”€â”€ PlanDay (æ—¥ç¨‹) 1:N
â”‚   â””â”€â”€ PlanActivity (æ´»åŠ¨) 1:N
â””â”€â”€ Anniversary (çºªå¿µæ—¥) N:1 (å¯é€‰å…³è”)
```

### 2.2 å­—æ®µè¯´æ˜

| å®ä½“             | å­—æ®µ                                | è¯´æ˜       |
| ---------------- | ----------------------------------- | ---------- |
| **Plan**         | Title, Type, StartDate, EndDate     | åŸºæœ¬ä¿¡æ¯   |
|                  | Budget, ActualCost, Currency        | é¢„ç®—è¿½è¸ª   |
|                  | Status (draft/confirmed/completed)  | çŠ¶æ€æœº     |
|                  | IsSecret, ReminderDays              | æƒŠå–œä¸æé†’ |
| **PlanDay**      | DayNumber, Date, Theme              | æ—¥ç¨‹å®šä¹‰   |
| **PlanActivity** | Title, Location, StartTime, EndTime | æ´»åŠ¨è¯¦æƒ…   |
|                  | EstimatedCost, ActualCost, Notes    | èŠ±è´¹è¿½è¸ª   |

## 3. API ç«¯ç‚¹

### 3.1 è®¡åˆ’ç®¡ç† (Admin Only)

| æ–¹æ³•   | è·¯å¾„                    | è¯´æ˜                        |
| ------ | ----------------------- | --------------------------- |
| GET    | `/api/admin/plans`      | è·å–æ‰€æœ‰è®¡åˆ’åˆ—è¡¨            |
| GET    | `/api/admin/plans/{id}` | è·å–è®¡åˆ’è¯¦æƒ…ï¼ˆå«æ—¥ç¨‹/æ´»åŠ¨ï¼‰ |
| POST   | `/api/admin/plans`      | åˆ›å»ºæ–°è®¡åˆ’                  |
| PUT    | `/api/admin/plans/{id}` | æ›´æ–°è®¡åˆ’åŸºæœ¬ä¿¡æ¯            |
| DELETE | `/api/admin/plans/{id}` | åˆ é™¤è®¡åˆ’                    |

### 3.2 æ—¥ç¨‹ç®¡ç†

| æ–¹æ³•   | è·¯å¾„                             | è¯´æ˜     |
| ------ | -------------------------------- | -------- |
| POST   | `/api/admin/plans/{planId}/days` | æ·»åŠ æ—¥ç¨‹ |
| PUT    | `/api/admin/plans/days/{dayId}`  | æ›´æ–°æ—¥ç¨‹ |
| DELETE | `/api/admin/plans/days/{dayId}`  | åˆ é™¤æ—¥ç¨‹ |

### 3.3 æ´»åŠ¨ç®¡ç†

| æ–¹æ³•   | è·¯å¾„                         | è¯´æ˜     |
| ------ | ---------------------------- | -------- |
| POST   | `/api/admin/activities`      | æ·»åŠ æ´»åŠ¨ |
| PUT    | `/api/admin/activities/{id}` | æ›´æ–°æ´»åŠ¨ |
| DELETE | `/api/admin/activities/{id}` | åˆ é™¤æ´»åŠ¨ |

## 4. å‰ç«¯é¡µé¢

### 4.1 ç®¡ç†åå°

| è·¯å¾„                | åŠŸèƒ½                            |
| ------------------- | ------------------------------- |
| `/admin/plans`      | è®¡åˆ’åˆ—è¡¨ï¼ˆå¡ç‰‡è§†å›¾ï¼‰            |
| `/admin/plans/new`  | æ–°å»ºè®¡åˆ’è¡¨å•                    |
| `/admin/plans/[id]` | ç¼–è¾‘è®¡åˆ’ï¼ˆæ—¥å†è§†å›¾ + é¢„ç®—å›¾è¡¨ï¼‰ |

### 4.2 ç»„ä»¶åº“

| ç»„ä»¶               | è·¯å¾„               | åŠŸèƒ½                       |
| ------------------ | ------------------ | -------------------------- |
| `PlanCalendarView` | `components/plan/` | æ—¥å†è§†å›¾ï¼Œé«˜äº®è®¡åˆ’æ—¥æœŸ     |
| `BudgetChart`      | `components/plan/` | é¢„ç®—è¿›åº¦æ¡å¯¹æ¯”å›¾è¡¨         |
| `SurpriseReveal`   | `components/plan/` | æƒŠå–œæ­æ™“å¼¹çª—ï¼ˆå¸¦å½©å¸¦åŠ¨ç”»ï¼‰ |

## 5. é‚®ä»¶æé†’

### 5.1 æé†’æœºåˆ¶

- **è§¦å‘æ—¶æœº**ï¼šåå° `AnniversaryReminderHostedService` æ¯å¤© 08:00 æ£€æŸ¥
- **æé†’è§„åˆ™**ï¼šæ ¹æ® `ReminderDays` å­—æ®µè®¾ç½®ï¼ˆå¦‚ "7,3,1" = æå‰ 7/3/1 å¤©æé†’ï¼‰
- **å»é‡æœºåˆ¶**ï¼šé€šè¿‡ `PlanNotification` è¡¨è®°å½•å·²å‘é€æé†’

### 5.2 é‚®ä»¶æ¨¡æ¿

- **æ¨¡æ¿ Key**ï¼š`plan_reminder`
- **å ä½ç¬¦**ï¼š`{{PlanTitle}}`, `{{StartDate}}`, `{{DaysLeft}}`, `{{Type}}`

## 6. æƒŠå–œåŠŸèƒ½

### 6.1 ç§˜å¯†è®¡åˆ’

- è®¾ç½® `IsSecret = true` æ ‡è®°ä¸ºæƒŠå–œè®¡åˆ’
- æƒŠå–œè®¡åˆ’ä¸ä¼šåœ¨å¸¸è§„åˆ—è¡¨ä¸­æ˜¾ç¤ºï¼ˆéœ€ç‰¹æ®Šå…¥å£ï¼‰
- çºªå¿µæ—¥å½“å¤©æˆ–æŒ‡å®šæ—¶é—´è§¦å‘ `SurpriseReveal` å¼¹çª—

### 6.2 æ­æ™“åŠ¨ç”»

- ä½¿ç”¨ `canvas-confetti` åº“å®ç°å½©å¸¦æ•ˆæœ
- æ¸å˜èƒŒæ™¯ + è£…é¥°å…ƒç´ 
- æ­æ™“å‰ï¼šç¥ç§˜ç¤¼ç›’åŠ¨ç”»
- æ­æ™“åï¼šæ˜¾ç¤ºè®¡åˆ’è¯¦æƒ…

## 7. å¤©æ•°è®¡ç®—é€»è¾‘

```
å¤©æ•° = EndDate - StartDate + 1
```

- **æœ‰ç»“æŸæ—¥æœŸ**ï¼šæ­£å¸¸è®¡ç®—
- **æ— ç»“æŸæ—¥æœŸ**ï¼šé»˜è®¤ 1 å¤©

## 8. æŠ€æœ¯ä¾èµ–

### åç«¯

- Entity Framework Coreï¼ˆCode Firstï¼‰
- é‚®ä»¶æ¨¡æ¿æœåŠ¡ (`IEmailTemplateService`)

### å‰ç«¯

- `canvas-confetti`ï¼šå½©å¸¦åŠ¨ç”»
- shadcn/uiï¼šUI ç»„ä»¶åº“

## 9. åç»­ä¼˜åŒ–

- [ ] æ´»åŠ¨ç¼–è¾‘åŠŸèƒ½
- [ ] æƒŠå–œå¼¹çª—è§¦å‘é›†æˆ
- [ ] å®é™…èŠ±è´¹æ›´æ–°
- [ ] æ—¥ç¨‹æ‹–æ‹½æ’åº
- [ ] è®¡åˆ’é¢„è§ˆ/åˆ†äº«é¡µ
- [ ] çºªå¿µæ—¥å…³è”å¿«æ·å…¥å£

---

_Created: 2025-12-29_
